<!DOCTYPE html><html prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Meteor custom account 강좌 3 · freeseamew`s blog</title><meta name="description"><meta name="og:url" content="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-3/"><meta name="og:type" content="article"><meta name="og:title" content="Meteor custom account 강좌 3"><meta name="og:description"><meta name="og:image" content="http://freeseamew.github.io/logo3.png"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><meta name="fb:app_id" content="1765163213798195"><link rel="search" type="application/opensearchdescription+xml" href="http://freeseamew.github.io/atom.xml" title="freeseamew`s blog"></head><body><div id="fb-root"></div><div class="wrap"><header><a class="logo-link" href="/"><img src="/logo3.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">목록보기</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Meteor custom account 강좌 3</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/freeseamew" target="_blank"><img src="/image/profile.png"></a></div><div class="post-info-details"><div class="post-categories"></div><div class="post-date">Jul 4, 2017에 쓰여진 글입니다.</div></div></div><div class="post-share"><div class="fb-like" data-href="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-3/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-follow" data-href="https://www.facebook.com/freeseamew" data-layout="button_count" data-size="small" data-show-faces="true">   </div><div class="fb-save" data-uri="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-3/" data-size="small"></div></div><div class="post-content"><h3 id="6-비밀번호-변경-및-재발급"><a href="#6-비밀번호-변경-및-재발급" class="headerlink" title="6. 비밀번호 변경 및 재발급"></a>6. 비밀번호 변경 및 재발급</h3><h4 id="6-1-비밀번호-변경"><a href="#6-1-비밀번호-변경" class="headerlink" title="6.1 비밀번호 변경"></a>6.1 비밀번호 변경</h4><p>이제 기본적으로 회원가입, 로그인, 로그아웃에 대한 기능들은 모두 만들었습니다. 다음은 비밀번호 찾기 및 재발급에 대한 기능을 추가해 보겠습니다.<br>아래는 비밀번호 변경 html 파일소스입니다. 기존비번, 새비번, 새비번 확인의 3가지  텍스트 박스로 구성된 폼 입니다. </p>
<p><code>client/change-password.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;template name=&quot;changePassword&quot;&gt;</div><div class="line">  &lt;div class=&quot;panel panel-default col-md-6 col-md-offset-3  panel-custom&quot;&gt;</div><div class="line">    &lt;div class=&quot;panel-heading text_center&quot;&gt;</div><div class="line">      &lt;a href=&quot;&#123;&#123;pathFor &apos;/&apos;&#125;&#125;&quot;&gt;&lt;h2&gt;METEOR ACCOUNTS&lt;/h2&gt;&lt;/a&gt;</div><div class="line">      &lt;p&gt;비밀번호 변경&lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;div class=&quot;panel-body panel-body-set&quot;&gt;</div><div class="line"></div><div class="line">      &lt;form class=&quot;col-md-12 panel-body-inner&quot;&gt;</div><div class="line">        &lt;div class=&quot;form-group&quot;&gt;</div><div class="line">          &lt;input type=&quot;text&quot; id=&quot;old-password&quot;  class=&quot;form-control account-text-form-1&quot; placeholder=&quot;기존 비밀번호&quot;&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">        &lt;div class=&quot;form-group&quot;&gt;</div><div class="line">          &lt;input type=&quot;text&quot; id=&quot;new-password&quot;  class=&quot;form-control account-text-form-1&quot; placeholder=&quot;새 비밀번호&quot;&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">        &lt;div class=&quot;form-group&quot;&gt;</div><div class="line">          &lt;input type=&quot;text&quot; id=&quot;new-password-confirm&quot; class=&quot;form-control account-text-form-1&quot; placeholder=&quot;새 비밀번호 확인&quot;&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">      &lt;/form&gt;</div><div class="line">      &lt;div class=&quot;form-group panel-body-inner bottom-padding&quot;&gt;</div><div class="line">        &lt;button name=&quot;change-password&quot; class=&quot;btn btn-danger btn-lg btn-block button&quot;&gt;비밀번호 변경&lt;/button&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/template&gt;</div></pre></td></tr></table></figure>
<p>다음은 이 폼이 실제로 실행될 자바스크립트 파일입니다. 지금까지와의 소스와 조금 다른 점이 있다면 패스워드 변경 api인 <code>Accounts.changePassword</code>이 클라이언트 측에서 실행된다는 점입니다. 그래서 폼검증을 서버가 아닌 클라이언트에서 실행시켜 주는 것을 볼 수 있습니다. 이전 강좌에서도 말했듯 <code>lib</code> 폴더의 있는 소스는 클라이언트와 서버 모두에서 사용 가능하다는 것을 다시한번 확인 할 수 있습니다. </p>
<p><code>client/change-password.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Template.changePassword.events(&#123;</div><div class="line">  &apos;click button[name=change-password]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line"></div><div class="line">    evt.preventDefault(); //새로 고침 방지</div><div class="line"></div><div class="line">    var oldPassword = tmpl.find(&apos;#old-password&apos;).value;</div><div class="line">    var newPassword = tmpl.find(&apos;#new-password&apos;).value;</div><div class="line">    var newPasswordConfirm = tmpl.find(&apos;#new-password-confirm&apos;).value;</div><div class="line"></div><div class="line"></div><div class="line">    try</div><div class="line">    &#123;</div><div class="line">      NotEmptyString(oldPassword);</div><div class="line">      NotEmptyString(newPassword);</div><div class="line">      NotEmptyString(newPasswordConfirm);</div><div class="line">      isValidPassword(newPassword);</div><div class="line">      isMatchPassword(newPassword, newPasswordConfirm);</div><div class="line">    &#125;</div><div class="line">    catch(err)</div><div class="line">    &#123;</div><div class="line">      Bert.alert( err.message , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line"></div><div class="line">      return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Accounts.changePassword(oldPassword, newPassword, function(err)</div><div class="line">    &#123;</div><div class="line">      if(!err)</div><div class="line">      &#123;</div><div class="line">        Bert.alert(&apos;패스워드를 변경했습니다.&apos; , &apos;success&apos;, &apos;growl-top-right&apos;);</div><div class="line">      &#125;</div><div class="line">      else</div><div class="line">      &#123;</div><div class="line">        console.log(err);</div><div class="line"></div><div class="line">        var errMessage = &apos;&apos;;</div><div class="line"></div><div class="line">        if(err.message === &apos;Incorrect password [403]&apos;)</div><div class="line">        &#123;</div><div class="line">          errMessage = &quot;기존 비밀번호가 다릅니다.&quot;</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">          errMessage = err.message;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        Bert.alert( errMessage , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>Meteor API는 그 성격에 따라 클라이언트, 서버 모두에서 실행되기도 하고, 각각에서만 실행되는 경우도 있습니다. 아래 링크에는 각 API가 어떤 곳에서 실행되는지 잘 정리되어 있습니다. 가끔 왜 이곳에서 실행이 안되지 할 때 확인해 보시면 도움을 받을 수 있습니다. </p>
<blockquote>
<p><a href="http://frozeman.de/blog/2015/01/meteor-cheatsheet/" target="_blank" rel="noopener">http://frozeman.de/blog/2015/01/meteor-cheatsheet/</a></p>
</blockquote>
<hr>
<h4 id="6-2-비밀번호-재발급-잊어버렸을-때"><a href="#6-2-비밀번호-재발급-잊어버렸을-때" class="headerlink" title="6.2 비밀번호 재발급(잊어버렸을 때)"></a>6.2 비밀번호 재발급(잊어버렸을 때)</h4><p>비밀번호 변경과 함께 자주 쓰게 될 기능은 비밀번호 재발급이 될 것입니다. 비슷한 기능 같지만, 재발급의 경우 비밀번호를 잊어버렸을 경우에 사용되는 기능입니다.<br>재발급 과정을 설명드리겠습니다. </p>
<blockquote>
<p>재발급 과정 : 재발급 페이지(가입 이메일 입력) -&gt; 가입 이메일 페이지에서 링크 확인 -&gt; 재발급 페이지에서 비밀번호 변경</p>
</blockquote>
<ol>
<li>재발급 페이지</li>
</ol>
<p><img src="https://lh3.googleusercontent.com/b502yJY5IKW-c0hzmFGfO6iQG4yxzX4b-6otBlL3OE0kq4mLgIGFQoaj6t0-x4rHN24V57P5-XcguT3tzaJStYj9-Ii-u_Vy-zKiFrD1KEmJ-Hd5D3_QD8VZwpyQWNqfwbVvbG9A696RR5hjWa4vAfKiXwLLX_DbSLnmrM7DcoHYaBVPAaAQNWa_62HlNLv_4X8T5kKg_k3WwJ5qP0vAksP1MJtfOKfGp0JCqWoZBvCuHlAtC_LWVxjR-2RaBHVzaWatE_Jow0E8EzIFIZS3oQeGzmAgZTs4mDaMQQg8EZtMK_OxnhEJcMxTmt_0dvPGdAVLg20T9nDEuwdG4c0ort-p5fN5a3_5qDoOqjR13rFQtjrxpQVg39JnXXEDP8pPjQMpzEblOAdeGxfs87mtU7HxnGtoCbi212Jb9cQCzhy5vtSvu6fAiTBfS1_Vu7VOyXrlhHk9beCc-ykTPtA7g1lin_OtMJuMab4I9h1ficD5CXISIrqAq5z0hIwHiBYWNYzdP_HrTriFtD-Z1gX00N5vScS7suow1lYy0AL3MmPnXzTsSCgU59mffNwl-QWciLi1OPf8tOVSAM0DNhIlqQnBFHhVM_6eVvmrpPnkrnyrcHI8RxsqA92MSVT0zQqfvRHqh83alr_UEtH-13gUitLT4fQ1mzolIqE5CDnq8kQ=w599-h318-no"></p>
<ol>
<li>가입 메일에서 재발급 페이지 링크 확인</li>
</ol>
<p><img src="https://lh3.googleusercontent.com/U9-7PCzQ3fRaXc8BBWbj2MrD7dAdkhP3ntIkBmbbpbvp_ElCAunqcsswX613QFtxqbV1K6jY3i-wCsm-PopMEIy_PQETqjUdXdaIHx_PT56xWNKa4IO4u9UiJT93CJOGb4hfyiNxkFtrgGWXXq8SZaznlmuIHOvybw796KzfFOof0LQUFhipM9Q9gA31vGT9Vngbryp3RYFRnvdeyGnp1ithq2rsBMQxcAdYjb6RgXOTndxdIevtO3cNrKe-EIYxXoRYNGUpqjwHEKXrc_pxPy0kMIeE0shanzXGTAEhu70bRrjytckLXbVDlpGl4RuovZXz9oBg36fwaZOwTxym3Ip0bWUKJx6leCQMnJPihi_90_IoC5P_VjA2J3RLPt_CmNG0TffBmPJWKexZah80R4v28dup8n3nnEtAWOzxwlwCEGexsysW_XNVeblpQT8c3jVD_LZKnxHQoAkhDvdSDubr5320Aa0ohs0yVnAScGuu_-DnbDej0pFgCEoA-Qe4wBZgYs6K0RDPORscOn-WNv4cs-aO5FylWFVM3L-OsHyD8zTEYvO5dctnsySHVcjqX1Gn1BNeB4JkhVY-b1H-z69z2p5u2aMlhXcFDvAS4ZqP0ZvZX5bCF-Ej8iBHjID8ADODx0YzNEwkTNwakjGcnxWQvMzYJJJ47CSdEYtkPvw=w659-h116-no"></p>
<ol>
<li>재발급 페이지에서 비밀번호 변경</li>
</ol>
<p><img src="https://lh3.googleusercontent.com/JUTn6Anry7zeWb2CxT8DgB3WuwHFi3x3bNbkr2nrcDRmTLXTMpHVFQZ2MhLP0CoZ0Quf8OfCaX1u1WqrOputshtKYhOcHS-mD4B0aQ7-Exvej343tD0l5FrV6gWLuOrD1pyVxvAoJPwP-OoqZklCiyA7kl45q7iJt72HXee8jAUTULT-YEIcijc8AwJJOuH8AO8z9i8_zwmNF7Z_8IqUQU96ZyY4LHAzghoYZlVqHqz2STr5hdpXC_kM5RgqYKGN2NbrVjVMMSzrJYwQWlfFXlyzBZu_xUqwVobxo0by8R0TNlmIy-DMo6A0SHYUEXrdfeZU_y810I74UkUpyT_VJnR9kGKeDOZXZh_y-NUMgFRr_BZXWUKe_BQ-gPPJOpBF2YhH9iepZMTHnZqKbmJMK4ARgDyVgZ5w9yun7dYHc7mp8-1WVnNtijKBuyGw6SL15YT2S9BpEL1FkIMWhnTWWIpCtAfJiGNgVU4V52BLSO67JOBkwnmL-zofwRJYgu6J7EW9Gj6KQJXutMwDlTeVxIJc1siv0PM0koKp7JliGUP4Pm48zbQoG0Bc-eqfmVKDAcEyuxvPGzsNyP9JUvTqze1boGjRMmYd7LxAXdSeMV15_2cHvXbSXtOnyI20smJkQMg3ZWveoaQ2Aweq3aBsqMWgVmyqCErDpNxlUq3yVl8=w599-h389-no"></p>
<p>자 먼저 라우터를 추가해 보도록 하겠습니다. <code>recover</code>는 기본적인 재발급 페이지에 대한 주소가 되고, <code>reset-password</code>는 메일로 보내진 키 값을 확인하는 페이지가 되겠습니다. 키가 맞으면 <code>window.resetPasswordVar</code>라는 reactiveVar를 만들고 여기에 키값을 넣어 주는 식의 구조가 되겠습니다.  </p>
<p><code>lib/routes.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[위 생략]</div><div class="line"></div><div class="line"></div><div class="line">// 비밀번호 변경 관련</div><div class="line">FlowRouter.route(&apos;/ recover&apos;, &#123;</div><div class="line">  name:&apos;recoverPassword&apos;,</div><div class="line">  action: function()</div><div class="line">  &#123;</div><div class="line">    BlazeLayout.render(&apos;mainLayout&apos;, &#123;</div><div class="line">      content: &apos;recoverPassword&apos;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">FlowRouter.route( &apos;/reset-password/:token&apos;, &#123;</div><div class="line">  name: &apos;reset-password/&apos;,</div><div class="line">  action( params )</div><div class="line">  &#123;</div><div class="line">    window.resetPasswordVar = new ReactiveVar(params.token);</div><div class="line">    FlowRouter.go( &apos;/recover&apos; );</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>두번째로 패스워드 재발급의 경우도 메일을 통해서 이루어지므로 가입확인 메일과 다른  재발급 키 값에 대한 메일을 보내는 부분을 세팅하도록 하겠습니다. </p>
<p><code>server/accountsMails.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">// 가입확인 메일</div><div class="line">Accounts.emailTemplates.verifyEmail = &#123;</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[중략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line">// 비밀번호 변경 메일</div><div class="line">Accounts.emailTemplates.resetPassword = &#123;</div><div class="line">  subject() &#123;</div><div class="line">    return &quot;Meteor accounts 비밀번호 변경 메일&quot;;</div><div class="line">  &#125;,</div><div class="line">  text( user, url ) &#123;</div><div class="line">    //let emailAddress   = user.emails[0].address,</div><div class="line">    let emailAddress   = user.username,</div><div class="line">      urlWithoutHash = url.replace( &apos;#/&apos;, &apos;&apos; ),</div><div class="line">      supportEmail   = &quot;이메일 주소&quot;,</div><div class="line">      emailBody      = `비밀번호 변경 을 원하시면 다음 링크를 클릭해주세요. \n\n link: $&#123;urlWithoutHash&#125; \n\n 만약 확인을 요청하지 않은 경우, 이 이메일을 무시하십시오. 문제가 있다고 생각되면 다음 서비스 지원팀에 문의하십시오. \n\n 문의 주소 : $&#123;supportEmail&#125;.`;</div><div class="line"></div><div class="line">    console.log(&apos;mailUser&apos;);</div><div class="line">    console.log(user);</div><div class="line"></div><div class="line">    return emailBody;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>다음으로 <code>recover-password.html</code> 를 작성해 보도록 하겠습니다 소스에서 특별한 점은 <code>#if resetPassword ...else</code> 이 부분이 되겠는데요. 이메일로 보내진 키값을 확인해 reactiveVar로 넘겨진 <code>resetPasswordVar</code> 를 체크하여 값이 없으면 메일보내기 페이지를 키값이 있으면 새로운 비밀번호 입력 페이지를 보여주는 조건문이라고 보시면 되겠습니다. (reactiveVar의 경우 앞의 강좌에서 조금 설명드렸으니 그부분을 참고 하시면 도움이 될 것 같습니다. 기회가 되면 좀 더 자세히 다룰 만한 주제긴 하네요. 알아두면 참 편리한 기능이라고 생가하는 기능입니다.ㅎ)</p>
<p><code>client/recover-password.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">&lt;template name=&quot;recoverPassword&quot;&gt;</div><div class="line">  &#123;&#123;#if resetPassword&#125;&#125;</div><div class="line">    &lt;div class=&quot;panel panel-default col-md-6 col-md-offset-3  panel-custom&quot;&gt;</div><div class="line">      &lt;div class=&quot;panel-heading text_center&quot;&gt;</div><div class="line">        &lt;a href=&quot;&#123;&#123;pathFor &apos;/&apos;&#125;&#125;&quot;&gt;&lt;h2&gt;METEOR ACCOUNTS&lt;/h2&gt;&lt;/a&gt;</div><div class="line">        &lt;p&gt;비밀번호 변경&lt;/p&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">      &lt;div class=&quot;panel-body panel-body-set&quot;&gt;</div><div class="line"></div><div class="line">        &lt;form class=&quot;col-md-12 panel-body-inner&quot;&gt;</div><div class="line">          &lt;div class=&quot;form-group&quot;&gt;</div><div class="line">            &lt;input type=&quot;text&quot; id=&quot;reset-password&quot;  class=&quot;form-control account-text-form-1&quot; placeholder=&quot;비밀번호&quot;&gt;</div><div class="line">          &lt;/div&gt;</div><div class="line">          &lt;div class=&quot;form-group&quot;&gt;</div><div class="line">            &lt;input type=&quot;text&quot; id=&quot;reset-password-confirm&quot; class=&quot;form-control account-text-form-1&quot; placeholder=&quot;비밀번호 확인&quot;&gt;</div><div class="line">          &lt;/div&gt;</div><div class="line">        &lt;/form&gt;</div><div class="line">        &lt;div class=&quot;form-group panel-body-inner bottom-padding&quot;&gt;</div><div class="line">          &lt;button name=&quot;reset-password&quot; class=&quot;btn btn-danger btn-lg btn-block button&quot;&gt;비밀번호 변경&lt;/button&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &#123;&#123;else&#125;&#125;</div><div class="line">    &lt;div class=&quot;panel panel-default col-md-6 col-md-offset-3  panel-custom&quot;&gt;</div><div class="line">      &lt;div class=&quot;panel-heading text_center&quot;&gt;</div><div class="line">        &lt;a href=&quot;&#123;&#123;pathFor &apos;/&apos;&#125;&#125;&quot;&gt;&lt;h2&gt;METEOR ACCOUNTS&lt;/h2&gt;&lt;/a&gt;</div><div class="line">        &lt;p&gt;비밀번호 변경&lt;/p&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">      &lt;div class=&quot;panel-body panel-body-set&quot;&gt;</div><div class="line"></div><div class="line">        &lt;form class=&quot;col-md-12 panel-body-inner&quot;&gt;</div><div class="line">          &lt;div class=&quot;form-group&quot;&gt;</div><div class="line">            &lt;input type=&quot;text&quot; id=&quot;user-email&quot; class=&quot;form-control account-text-form-1&quot; placeholder=&quot;메일주소&quot;&gt;</div><div class="line">          &lt;/div&gt;</div><div class="line">        &lt;/form&gt;</div><div class="line">        &lt;div class=&quot;form-group panel-body-inner bottom-padding&quot;&gt;</div><div class="line">          &lt;button name=&quot;send-email&quot; class=&quot;btn btn-danger btn-lg btn-block button&quot;&gt;메일보내기&lt;/button&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &#123;&#123;/if&#125;&#125;</div><div class="line">&lt;/template&gt;</div></pre></td></tr></table></figure>
<p>위의 html페이지에 대한 js 파일을 작성해 보도록 하겠습니다. 우선 <code>Template.recoverPassword.helpers({})</code> 에 resetPassword라는 함수를 만들고 라우터에서 세팅된 <code>resetPasswordVar</code>를 get() 하는 소스를 작성해주세요. 이 부분 때문에 html페이지의 <code>#if resetPassword</code>이 작동하게 됩니다. </p>
<p><code>Accounts.resetPassword(resetPasswordVar.get(), password, function(err){})</code> 부분은 실제 패스워드를 재발급 하는 소스 입니다. 처음 <code>resetPasswordVar.get()</code> 는 메일로 발송된 키 값에 대한 검증하는 부분이 되겠습니다. 이 발급된 키가 맞다면 새로 입력하는 패스워드로 변경이 이루어 집니다. 보시면 알겠지만, 사용되는 API들이 상당히 꼼꼼하게 만들어 졌다는 것을 볼 수 있습니다. </p>
<p><code>client/recover-password.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">Template.recoverPassword.onRendered(function () &#123;</div><div class="line">  showLoadingEffect.set(false);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">Template.recoverPassword.helpers(&#123;</div><div class="line">  resetPassword: function()</div><div class="line">  &#123;</div><div class="line">    //return Session.get(&apos;resetPassword&apos;);</div><div class="line">    return resetPasswordVar.get();</div><div class="line">    Bert.alert( resetPasswordVar.get(), &apos;success&apos; );</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">Template.recoverPassword.events(&#123;</div><div class="line"></div><div class="line">  &apos;click button[name=reset-password]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">    evt.preventDefault();</div><div class="line"></div><div class="line">    var password = tmpl.find(&apos;#reset-password&apos;).value;</div><div class="line">    var passwordAgain = tmpl.find(&apos;#reset-password-confirm&apos;).value;</div><div class="line">    </div><div class="line">    // 입력 검증</div><div class="line">    try</div><div class="line">    &#123;</div><div class="line">      NotEmptyString(password);</div><div class="line">      NotEmptyString(passwordAgain);</div><div class="line">      isMatchPassword(password, passwordAgain);</div><div class="line">    &#125;</div><div class="line">    catch (err)</div><div class="line">    &#123;</div><div class="line">      Bert.alert( err.message , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 비밀번호 재발급</div><div class="line">    Accounts.resetPassword(resetPasswordVar.get(), password, function(err)</div><div class="line">    &#123;</div><div class="line">      if(err)</div><div class="line">      &#123;</div><div class="line">        Bert.alert( &apos;패스워드 변경중 오류가 발생했습니다.&apos;  , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">      &#125;</div><div class="line">      else</div><div class="line">      &#123;</div><div class="line">        Bert.alert(&apos;패스워드를 변경했습니다 &apos;, &apos;success&apos;, &apos;growl-top-right&apos;);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;,</div><div class="line">  &apos;click button[name=send-email]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">    evt.preventDefault();</div><div class="line">    showLoadingEffect.set(true);</div><div class="line"></div><div class="line">    var email = tmpl.find(&apos;#user-email&apos;).value; // trim 대기</div><div class="line">    Accounts.forgotPassword(&#123;email: email&#125;, function(err)</div><div class="line">    &#123;</div><div class="line">      if(err)</div><div class="line">      &#123;</div><div class="line">        if(err.message == &apos;User not found [403]&apos;)</div><div class="line">        &#123;</div><div class="line">          console.log(err.message);</div><div class="line">          showLoadingEffect.set(false);</div><div class="line">          Bert.alert( &apos;해당메일로 가입자가 없습니다.&apos; , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">          showLoadingEffect.set(false);</div><div class="line">          Bert.alert( &apos;오류로 메일 발송에 실패했습니다. 잠시후 다시 시도해주세요.&apos; , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      else</div><div class="line">      &#123;</div><div class="line">        showLoadingEffect.set(false);</div><div class="line">        Bert.alert( &apos;비밀번호 변경에 관한 메일을 발송했습니다.&apos; , &apos;success&apos;, &apos;growl-top-right&apos; );</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>이상으로 패스워드 재발급 까지 만들어 봤습니다. 이제 제법 그럴듯한 회원가입 기능이 구현된 것 같은데요. 다음 강좌에서는 마지막으로 각종 소셜 서비스를 통한 가입에 대한 기능을 구현해보도록 하겠습니다. 이제와서 말씀 드리지만 사실상 이 소스는 소셜 로그인 기능을 만들다가 정리된 소스라고 보셔도 됩니다.  매력적이고 많이 쓰이는 기능들이 meteor에서는 참 쉽게 사용할 수 있었던 것 같습니다. 그럼 다음강좌에서 소셜 로그인을 구현해 보는 것으로 Meteor custom account 강좌를 마무리 해보도록 하겠습니다 ^^</p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2017/07/04/meteor-account-tutorial-4/">PREV</a><a class="next" href="/2017/07/03/meteor-account-tutorial-2/">NEXT</a></div><div class="fb-comments" data-href="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-3/" data-width="700" data-numposts="5"></div><div id="disqus_thread"></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>window.fbAsyncInit=function(){FB.init({appId:"1765163213798195",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");</script></body></html>