<!DOCTYPE html><html prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Meteor custom account 강좌 5 · freeseamew`s blog</title><meta name="description"><meta name="og:url" content="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-5/"><meta name="og:type" content="article"><meta name="og:title" content="Meteor custom account 강좌 5"><meta name="og:description"><meta name="og:image" content="http://freeseamew.github.io/logo3.png"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><meta name="fb:app_id" content="1765163213798195"><link rel="search" type="application/opensearchdescription+xml" href="http://freeseamew.github.io/atom.xml" title="freeseamew`s blog"></head><body><div id="fb-root"></div><div class="wrap"><header><a class="logo-link" href="/"><img src="/logo3.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">목록보기</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Meteor custom account 강좌 5</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/freeseamew" target="_blank"><img src="/image/profile.png"></a></div><div class="post-info-details"><div class="post-categories"></div><div class="post-date">Jul 4, 2017\t</div></div></div><div class="post-share"><div class="fb-like" data-href="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-5/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-follow" data-href="https://www.facebook.com/freeseamew" data-layout="button_count" data-size="small" data-show-faces="true">   </div><div class="fb-save" data-uri="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-5/" data-size="small"></div></div><div class="post-content"><h3 id="8-다른-서비스-api를-통한-로그인-facebook-google-twitter-kakao"><a href="#8-다른-서비스-api를-통한-로그인-facebook-google-twitter-kakao" class="headerlink" title="8. 다른 서비스 api를 통한 로그인(facebook, google, twitter, kakao)"></a>8. 다른 서비스 api를 통한 로그인(facebook, google, twitter, kakao)</h3><p>이제 meteor 사용자 정의 계정(coustom account) 강좌의 마지막 챕터에 대해서 설명드리도록 하겠습니다. 이챕터에서는 각종 SNS 및 외부 서비스를 통한 로그인 연동을  구현해보도록 하겠습니다. 저번 강좌에도 조금 말씀드렸지만 이 강좌를 한번 써볼까 라고 생각한 것이 이 외부 서비스 연동을 테스트 해보면서 였습니다. 처음에 조금 헤매이기는 했지만, 몇몇 세팅만 익히면 이런 외부 소셜 로그인이 척척 붙어서 작동하는 모습은 정말 Meteor라는 플랫폼이 주는 생산성이 무엇인지를 잘 보여준다고 생각됩니다. 일단 facebook부터 연동을 해볼 텐데요. 나머지 기능들은 이 facebook API 인증과 거의 같은 구조라고 보시면 되겠습니다.<br>그럼 이제 시작해 보겠습니다. ^^</p>
<h4 id="8-1-facebook-API-인증"><a href="#8-1-facebook-API-인증" class="headerlink" title="8.1. facebook API 인증"></a>8.1. facebook API 인증</h4><p>처음으로 연동해볼 API는 facebook이 되겠습니다. 우선 페이스북 개발자센터(developers.facebook.com/apps) 에 앱을 등록해 주셔야 합니다. 그리고 여기서 여기서 <code>앱ID, 앱 시크릿 코드</code>를 사용해 진행되니 따로 기록해 두시면 좋습니다.</p>
<p><img src="https://lh3.googleusercontent.com/UM9PMs8UzOhmmvIKMLRIPu5mbF6NKUcvAwCy8KiimdTTfBjs_bUVM-_6yeNYIrb6HwmYpfDdjuxjwRjQomDUO9tRjy_fAYU-CiWIYrhKLLbIGKyCFQSjBXVFw1IyUOC0M0bKTDGHNr0gxstCkV6WrYiNGPJtCbvtOTowEFQwDFXVXCQf2HugCJCxdR5YjiwKIYh0dI26lrXbjguaNy6aJ-MSBAyBHujH0C1ZX4kb3sU4M5y9jop4zkobD1ytvGxcgBItHkUsSHA3LS-MC6_ThEnE-UQh5zLPEG3-QvRaC_vimsoeYEmBDxIETfY-LxgnMRU2TF39_wBGnA_4KV3gtlNCmQlYdwxWeBL6AY1Myo1nLbHnjzdYBseXx1D7Ng_99mP1MxJWmEu4uKJ26_3eYLqr79AoHELbuqHqD8Jtfg-vvWPPSkMwFWhdhT3LQjM4N0I6xgqVeLXD1SFI9JdZRv0HMFbFXv927EieesB5lKfqh6AMVD5VV2x-i1JSUxEGNupGO6RixjxbxXCUqlbJ3814xwIIJOX8uSpzcKso2UmEfpxySs8TQyuK_lzi1SfMsH1-b-Cwgd97s4EH4Ku6kJUysrciCjTr_ZQe1eW9OhojLgNx9vtcMJ-byhEH7FN4qbjrQjpNO1Hq8IsfgrnTk3lg3-sY21RH7mHjK4Do1nM=w1177-h554-no"></p>
<p>다음으로 다음 패키지를 설치해야 합니다. <code>service-configuration</code>는 위에서 말씀드린 앱ID나 시크릿키 등을 등록하는 것을 조금 편하게 해주는 config가 되겠습니다. 다음으로 <code>accounts-facebook</code>는 facebook api를 사용할 수 있게 해주는 패키지가 되겠습니다. </p>
<blockquote>
<p>설치 패키지 </p>
<ul>
<li>meteor add service-configuration</li>
<li>meteor add accounts-facebook</li>
</ul>
</blockquote>
<p>처음으로 할일은 다음을 참고하여 사용할 서비스의 키를 등록하는 것입니다. <code>Meteor.startup(function() {}</code> 부분의 <code>페이스북 옵션</code>을 작성해주시면 되겠습니다. 여기서 <code>appId</code>는 개발자 페이지의 <code>앱 ID</code>를 <code>secret</code>은 <code>앱 시크릿 코드</code> 를 입력해 주시면 되겠습니다. </p>
<p><code>server/main.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">// Set up login services</div><div class="line">Meteor.startup(function() &#123;</div><div class="line"></div><div class="line">  // 페이스북 옵션 </div><div class="line">  ServiceConfiguration.configurations.remove(&#123;</div><div class="line">    service: &quot;facebook&quot;</div><div class="line">  &#125;);</div><div class="line">  ServiceConfiguration.configurations.insert(&#123;</div><div class="line">    service: &quot;facebook&quot;,</div><div class="line">    appId: &apos;발급받은 앱 ID&apos;,</div><div class="line">    secret: &apos;발급받은 앱 시크릿 코드&apos;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line"></div><div class="line">  Accounts.config(&#123;</div><div class="line">    loginExpirationInDays: 1,</div><div class="line"></div><div class="line">[아래 생략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>이제 실제 액션을 통해서 페이스북 로그인이 일어나도록 만들어 보겠습니다. <code>login.js</code>에 아래 소스를 참고로 <code>&#39;click button[name=facebook]&#39; (evt, tmpl){}</code> 부분에 대한 부분을 입력해 주세요. 클릭을 하면 <code>Meteor.loginWithFacebook(function(err)</code> 을 호출하게 됩니다. 간단하죠 ^^</p>
<p><code>client/login.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Template.login.events(&#123;</div><div class="line">  &apos;click button[name=btn-singIn]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[중략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">    return false;</div><div class="line"></div><div class="line">  &#125;,</div><div class="line">  &apos;click button[name=facebook]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">    evt.preventDefault();</div><div class="line">    Meteor.loginWithFacebook(function(err)</div><div class="line">    &#123;</div><div class="line">      if(!err)</div><div class="line">      &#123;</div><div class="line">        FlowRouter.go(&apos;/&apos;);</div><div class="line">        console.log(currentUser);</div><div class="line">      &#125;</div><div class="line">      else</div><div class="line">      &#123;</div><div class="line">        console.log(err);</div><div class="line">        Bert.alert( err , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>마지막은 페이스북에서 가입 정보를 받아와 넣어주는 것입니다. 실제로 가입아이디(email) 등은 기본 user 객체에 저장되지만 그 외의 정보(성, 이름, 성별 등등)과 같은 정보의 경우 user.profile 객체 아래에 정리해 두면 됩니다. 참고로 각 서비스 별로 넘겨주는 가입자 정보는 다릅니다. 그래서 사이트에 맞게 정리해 주셔야만 합니다. facebook의 경우 <code>first_name</code>으로 넘어오는 값이 google은 <code>given_name</code> 으로 넘어 오는 것을 볼 수 있습니다. 각각의 서비스에서 제공하는 API가 어떤 형태로 개발자 문서 등을 통해서 꼭 확인하시고 필요한 값들을 정의해 사용하시면 되겠습니다. </p>
<p><code>server/accounts.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">//기타서비스(facebook 등) 으로 로그인시 profile정보를 따로 입력해줘야 함.</div><div class="line">Accounts.onCreateUser(function (options, user) &#123;</div><div class="line"></div><div class="line"></div><div class="line">  user.profile = options.profile;// 이렇게 안해주면 profile이 없는 상태로 가입됨...</div><div class="line"></div><div class="line">  // facebook profile 설정</div><div class="line">  if(user.services.facebook)</div><div class="line">  &#123;</div><div class="line">    user.username = user.services.facebook.email;</div><div class="line">    user.emails = [</div><div class="line">      &#123;</div><div class="line">        address: user.services.facebook.email,</div><div class="line">        verified: true</div><div class="line">      &#125;</div><div class="line">    ];</div><div class="line">    user.profile.serviceType = &apos;facebook&apos;;</div><div class="line">    user.profile.firstName = user.services.facebook.first_name;</div><div class="line">    user.profile.lastName = user.services.facebook.last_name;</div><div class="line">    user.profile.gender = user.services.facebook.gender;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">    </div><div class="line">  [아래 생략]</div><div class="line">  Meteor.setTimeout(function() &#123; </div><div class="line">  .</div><div class="line">  .</div><div class="line">  .</div></pre></td></tr></table></figure>
<blockquote>
<p>참고로 로그인 성공시 기본으로 제공되는 값들은 각 로그인 콜랙션의 services 아래에서 확인이 가능합니다. 이 부분을 가공해서 profile에 정형화 해서 저장하는 작업이 아래 코드 입니다. </p>
</blockquote>
<p><img src="https://lh3.googleusercontent.com/Ki2vXLqBrnp1ON6KkcSMQ5FZqwBDg9k3Ugq7JAh-UH-AckKI8VV6_bty6zlTSuUGyHF7sTApS5GX3-Tt8ZAu45OmRVpsdpPAVGiWPvKXyzwIOXlbXc6MuyXxR_ngfi__ZVnU3oO9sNMiLvz0f4SYVtIjMywr9-i8EgTD23222Mr_f5dfPv9R5Vk9pnQ_QKSx7rMco0e0omdT0tVUiDlylBv0BY36oLCFmX5cejLtbY_9mUUVmlukWK7w-29hynEbp45wYJVij85bdzCchCrxExnT_zM8n-gEE6w71h4s--9x2Nh3pbnKRpmP-BECDjmYutGUcLJQUQXNC7HvF0-U8puney9W3B5UQ0se_Cyb9GMg9C_ANGhNe6lEZ9NzG5djM3XhknduhpzxsTdqSvYF6_-KqIEl_9R-RhINQXfExyYBbCrlhxSy6vMmpxvqtq3pn1oTvt28gUBBJPmqNVhK_NGDjAS9hHrkt-z2jTbDuBdA-nDpLWRUyZ4KQIOm4S-0AxvA9MQgT-9YlLS5c_ytNUv1KPilcy5O1gc5P428wGJQf536xwRw1Uq2ugbfXyYM1ppXZxnr55S7lzP0_0HgPM3I8YSDvggIW7FGv1MQ-TiwO6A8190XtCPukxC7sK540_4yWSqznNdbgMJRzeQqsUIqFidWKSwyqFsKEWqDuvY=w1154-h721-no"></p>
<p>이제 페이스북버튼을 클릭해 보겠습니다. 정상적으로  <code>Meteor.loginWithFacebook</code>가 작동하여 팝업창이 뜨고 정확한 정보로 로그인을 하면 정상적으로 로그인 되는 것을 볼 수 있습니다. </p>
<p>이 과정을 요약하면 아래와 같습니다. </p>
<blockquote>
<p>1단계. 연동할 서비스의 개발자 센터에서 서비스 등록 후 키값 받기<br>2단계. ServiceConfiguration.configurations에 키 등록<br>3단계. 소셜 버튼 클릭시 Meteor.loginWithFacebook() 호출<br>4단계. Accounts.onCreateUser()시 user.profile 에 사용자 정보 입력</p>
</blockquote>
<p>나머지도 위의 4가지 과정을 똑같이 반복하면 됩니다. 그럼 나머지 서비스도 연동해보도록 하겠습니다. </p>
<hr>
<h4 id="8-2-google-API-인증"><a href="#8-2-google-API-인증" class="headerlink" title="8.2. google API 인증"></a>8.2. google API 인증</h4><p>구글도 개발자 센터(<a href="https://console.cloud.google.com/)에" target="_blank" rel="external">https://console.cloud.google.com/)에</a> 가입하고 프로젝트를 만든 다음 키 값을 받아오면 됩니다. <code>클라이언트 ID</code>와 <code>클라이언트 보안 비밀</code>이 사용됩니다. google의 경우 <code>google cloud platform</code> 에서 <code>API 관리자</code>로 들어가 발급을 할 수 있는데요. 먼가 좀 경로가 복잡하긴 하니 아래 이미지를 참고로 위치를 찾아가시면 도움이 되실 것 같습니다. </p>
<p><img src="https://lh3.googleusercontent.com/23qwTQPXXLJChBYUiSiU61d6IYCwGz7GQy44IdHkusqsg79aCgmuIC0brIZAJQq2qCdJx8Q_0pfAVrcxjDT8I--ziNFiV6neFHqyNBKJ8HGSXajDYrUdQy_tsUvOVUJ2kLmGJ39fzoBvO6iCcbC9szhhs5VI7GSvKGzk1XuOYgpEA40yI6z-IjISy8CEvpVRBFXGsZV7TNtjijzhR4wfGK_v472qQSr2SMTccoe2RHLZyJcuiqK-BhHtv_3VghRwbx604ucj4RM9Nxo2dLcG-kAwDzmUOaxi_YHRrDLhyojZxzlc7MZ9woxtfeToYYEq6cnM9o6P0HempaE4cwAkyj1DLBIda67dJnvfGgWnsrPtADdXsMano39CyrNk88ZkT4U4ul7c-A7GQL-90qv5TsfK9PkCkrVHn1oTh-CxyJ5eV_TvsqcRDXfWVnVEcPbgQDKTl2FFkxTEssSR2g32PnQqlFQ1itIfy0q5ddJ2ZymxFhYlseIqzb-sQ7fUNDedGHMQB5A62QG2cJKNWRmf7_wdcX79-IHrcVpEND9rHwmAIp3HoNoo2p3QPVXTiIHZXhbWlgcSkeAjNjKmgXcjRnCMbNgapogxhiu9Ic4C0cayze2jJonz8Gx4f2R4sAlPldqTVpMUdlwTJudXRmTtHGuDQqBOj4080ptf8Mh-vyM=w1191-h766-no"></p>
<p>다음 패키지를 설치해주세요.</p>
<blockquote>
<p>설치 패키지<br>meteor add accounts-google</p>
</blockquote>
<p>다음은 <code>main.js</code> configuration에 개발자 센터에서 받은 키 값을 등록 합니다. </p>
<p><code>server/main.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">// Set up login services</div><div class="line">Meteor.startup(function() &#123;</div><div class="line"></div><div class="line">  ServiceConfiguration.configurations.remove(&#123;</div><div class="line">    service: &quot;facebook&quot;</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[위 생략]</div><div class="line"></div><div class="line">  // google 인증 API 설정</div><div class="line">  ServiceConfiguration.configurations.remove(&#123;</div><div class="line">    service: &quot;google&quot;</div><div class="line">  &#125;);</div><div class="line">  ServiceConfiguration.configurations.insert(&#123;</div><div class="line">    service: &quot;google&quot;,</div><div class="line">    clientId: &quot;발급받은 클라이언트 ID&quot;,</div><div class="line">    secret: &apos;발급받은 클라이언트 보안 비밀&apos;,</div><div class="line">    loginStyle: &quot;popup&quot;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">  Accounts.config(&#123;</div><div class="line">    loginExpirationInDays: 1,</div><div class="line"></div><div class="line">[아래 생략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div></pre></td></tr></table></figure>
<p>로그인 페이지에서 <code>google</code>버튼을 클릭하면 로그인이 진행되도록 아래 코드를 입력합니다. </p>
<p><code>clinet/login.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Template.login.events(&#123;</div><div class="line">  &apos;click button[name=btn-singIn]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[중략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">    return false;</div><div class="line"></div><div class="line">  &#125;,</div><div class="line">  &apos;click button[name=facebook]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">  ...[중략]</div><div class="line">  &#125;,</div><div class="line">  // google 로그인 클릭 추가 </div><div class="line">  &apos;click button[name=google]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">    evt.preventDefault();</div><div class="line">    Meteor.loginWithGoogle(function(err)</div><div class="line">    &#123;</div><div class="line">      if(!err)</div><div class="line">      &#123;</div><div class="line">        FlowRouter.go(&apos;/&apos;);</div><div class="line">      &#125;</div><div class="line">      else</div><div class="line">      &#123;</div><div class="line">        console.log(err);</div><div class="line">        Bert.alert( err , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>google로 부터 받아온 값을 profile에 등록하는 설정을 해줍니다. </p>
<p><code>server/accounts.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">//기타서비스(facebook) 으로 로긴시 profile정보를 따로 입력해줘야 한다.</div><div class="line">Accounts.onCreateUser(function (options, user) &#123;</div><div class="line"></div><div class="line"></div><div class="line">  user.profile = options.profile;// 이렇게 안해주면 profile이 없는 상태로 가입됨...</div><div class="line"></div><div class="line">  // facebook profile 설정</div><div class="line">  if(user.services.facebook)</div><div class="line">  &#123;</div><div class="line">  ...[중략]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // google profile 설정</div><div class="line">  if(user.services.google)</div><div class="line">  &#123;</div><div class="line">    user.emails = [</div><div class="line">      &#123;</div><div class="line">        address: user.services.google.email,</div><div class="line">        verified: true</div><div class="line">      &#125;</div><div class="line">    ];</div><div class="line">    user.profile.serviceType = &apos;google&apos;;</div><div class="line">    user.username = user.services.google.name;</div><div class="line">    user.profile.firstName = user.services.google.given_name;</div><div class="line">    user.profile.lastName = user.services.google.family_name;</div><div class="line">    user.profile.gender = user.services.google.gender;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  </div><div class="line">  [아래 생략]</div><div class="line">  Meteor.setTimeout(function() &#123; </div><div class="line">  .</div><div class="line">  .</div><div class="line">  .</div></pre></td></tr></table></figure>
<p>자이제 google로도 로그인 해보세요. 문제가 없다면 정상적으로 로그인 로그인 되는 것을 볼 수 있을 것입니다. </p>
<hr>
<h4 id="8-3-twitter-API-인증"><a href="#8-3-twitter-API-인증" class="headerlink" title="8.3. twitter API 인증"></a>8.3. twitter API 인증</h4><p>다음은 twitter 입니다. 과정은 역시 비슷합니다. </p>
<p>처음으로 할일은 개발자 사이트에서 키 값을 받는것 입니다. 트위터에서 사용하는 값들은 <code>Consumer Key(API Key)</code>와 <code>Consumer Secret(API Secret)</code>가 되겠습니다. </p>
<p><img src="https://lh3.googleusercontent.com/6XwhCbtcCFEA3Uy0eYJBD9wt7cdxpnEmZSDZ4fGrrJa1mhD9SDGpNk1Hkxjxh1Qo0N0-3_EdR5g39Ib4fIwJCwEWIr_cpHOidoKYayXiC_5Mv-xBy_sqMSinmoQcHs2VNOHlYUytuDbO_naeMnKBFPLGyXBLAmGRD-2lRQhbmw4TiQ_ukBf3MXOERLVYj0KQ6ohDEwQ5_OCJ3DYOWKxbJ-5zILkeAy4FMdixm7ZStAqdg8Q6IODFznd_UJx2QnyLxp408P6KOdzLB4P3wcdVWNsqXW__A8yRu7kdLzQXupiIwDsisk_YbcXv4CpbGWjeYiW093-olxptPDX8TvxU0vY9Orm-reRaLZgeCHqAISI7txNoYqg4v-7FuwQS_20PqrCtu0CLs-wj_t4qchBSL8gDDUr9ANHDqFJGgu6dfiy3j12KlARwYHl0_4e4qCENbjZmlY5tNzwEf-vpZaiSljaN9wGD7ZYz-Gu_qCKIoVhPuB09hpwFbfxtsTdkxdZliOOQDLZulRn3LPyjW6Qh6AhWo28q7AGZC6XNwQCs-sDJVUIeeLDRJzSvcmTIs2jkTy9OfA_fPnwaqZa2pmMxnlsf90CQ-lsAdaS1K1byHeRXjkOAi9kVzxy6T3XoO5N3JOdp9lcopdUYvpECu2wp-Immz6dnNM1sxbVFORWPSqk=w621-h677-no"></p>
<p>다음 패키지를 설치해주세요.</p>
<blockquote>
<p>설치 패키지<br>meteor add accounts-twitter</p>
</blockquote>
<p>다음은 <code>main.js</code> configuration에 개발자 센터에서 받은 키 값을 등록 합니다. </p>
<p><code>server/main.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">// Set up login services</div><div class="line">Meteor.startup(function() &#123;</div><div class="line"></div><div class="line">  ServiceConfiguration.configurations.remove(&#123;</div><div class="line">    service: &quot;facebook&quot;</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[위 생략]</div><div class="line"></div><div class="line">  // twitter 인증 API 설정</div><div class="line">  ServiceConfiguration.configurations.remove(&#123;</div><div class="line">    service: &quot;twitter&quot;</div><div class="line">  &#125;);</div><div class="line">  ServiceConfiguration.configurations.insert(&#123;</div><div class="line">    service: &quot;twitter&quot;,</div><div class="line">    consumerKey: &quot;발급받은 consumer Key,</div><div class="line">    loginStyle: &quot;popup&quot;,</div><div class="line">    secret: &quot;발급받은 consumer secret&quot;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line"></div><div class="line">[아래 생략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">  Accounts.config(&#123;</div><div class="line">    loginExpirationInDays: 1,</div></pre></td></tr></table></figure>
<p>로그인 페이지에서 <code>twitter</code>버튼을 클릭하면 로그인이 진행되도록 아래 코드를 입력합니다. </p>
<p><code>clinet/login.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Template.login.events(&#123;</div><div class="line">  &apos;click button[name=btn-singIn]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[중략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">    return false;</div><div class="line"></div><div class="line">  &#125;,</div><div class="line">  &apos;click button[name=facebook]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">  ...[중략]</div><div class="line">  &#125;,</div><div class="line">  // twitter 로그인 클릭 추가 </div><div class="line">  &apos;click button[name=twitter]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">    evt.preventDefault();</div><div class="line">    Meteor.loginWithTwitter(function(err)</div><div class="line">    &#123;</div><div class="line">      if(!err)</div><div class="line">      &#123;</div><div class="line">        FlowRouter.go(&apos;/&apos;);</div><div class="line">      &#125;</div><div class="line">      else</div><div class="line">      &#123;</div><div class="line">        console.log(err);</div><div class="line">        Bert.alert( err , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>twitter 부터 받아온 값을 profile에 등록하는 설정을 해줍니다. </p>
<p><code>server/accounts.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">//기타서비스(facebook) 으로 로긴시 profile정보를 따로 입력해줘야 한다.</div><div class="line">Accounts.onCreateUser(function (options, user) &#123;</div><div class="line"></div><div class="line"></div><div class="line">  user.profile = options.profile;// 이렇게 안해주면 profile이 없는 상태로 가입됨...</div><div class="line"></div><div class="line">  // facebook profile 설정</div><div class="line">  if(user.services.facebook)</div><div class="line">  &#123;</div><div class="line">  ...[중략]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // google profile 설정</div><div class="line">  // twitter profile 설정</div><div class="line">  if(user.services.twitter)</div><div class="line">  &#123;</div><div class="line">    user.emails = [</div><div class="line">      &#123;</div><div class="line">        address: &apos;none&apos;,</div><div class="line">        verified: true</div><div class="line">      &#125;</div><div class="line">    ];</div><div class="line">    user.profile.serviceType = &apos;twitter&apos;;</div><div class="line">    user.username = user.services.twitter.screenName;</div><div class="line">    user.profile.firstName = user.services.twitter.screenName;</div><div class="line">    user.profile.lastName = &apos;none&apos;;</div><div class="line">    user.profile.gender = &apos;&apos;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  [아래 생략]</div><div class="line">  Meteor.setTimeout(function() &#123; </div><div class="line">  .</div><div class="line">  .</div><div class="line">  .</div></pre></td></tr></table></figure>
<p>자이제 twitter로도 로그인 해보세요. 문제가 없다면 정상적으로 로그인 로그인 되는 것을 볼 수 있을 것입니다. </p>
<hr>
<h4 id="8-4-kakao-API-인증"><a href="#8-4-kakao-API-인증" class="headerlink" title="8.4. kakao API 인증"></a>8.4. kakao API 인증</h4><p>이제 마지막으로 kakao API연동을 해보겠습니다. 한국에서 많이 사용하는 kakao의 경우 한국 개발자 분이 패키지를 만들어 둔 상태입니다. 덕분에 kakao도 쉽게 연동할 수 있습니다. ^^</p>
<p>처음으로 할일은 개발자 사이트에서 키 값을 받는것 입니다. kakao에서 사용하는 값들은 <code>REST API키</code>가 되겠습니다. 한가지 아쉬운 점은 현재 패키지의 경우 Client Secret설정을 활성화 하면 작동을 안한다는 점입니다. 그래서 다른 서비스와 다르게 secret을 아직까지 사용할 수 없습니다. </p>
<p><img src="https://lh3.googleusercontent.com/z-kvzGozLx5iekATs1eIHFocQAftXp4rIOelJGQqQSUlw_iz3w_wGq9Gdvfyb6koGIqvgO707d-akKyCZOc39-thoK-LPXmZPVDHy47w1oowsyEiv1N62C9aDWeHVaswmjXTz1jueNRebVgmsry0Dg_yPSZZw5Lk0JGjCMA6NHDiuSXi2NP5aFf57tm35zbjm_twhGA41k6wN0Ow68xaDoA6Vi7TnNp_ilpXatP2tcqqMB13k1nRBQT4HUk5MwJVPgRH4BNExejE9tx727G_j9YUX41jDnEIJmUjawJK7jTf7gkuF571ZlXYd8L53boLWr0gcSt6-9ivFPjwnEBgu81ViAbC0Ocprud63tGIe804VPFMO136_pjR5A3NEQL-9RVXIuYVl24x8V-jD4dgGYUCm0WoQ6tg44Ei-UJzfu7JmsxG0156mgtBMp0UhTrgkKr2TdLebUEboZWYivHiWJ82pi0f_2ob2nubDloyp2SvXAFPEBiIvBIG2QXt6xIKJ0JX32H2sIv-W5GuzX8FZY1bWUK42jaCQ34EG5z9yndxbP9a0dlY8CYWnNTr_VkbNQBTuv9e1jcS8q3DaEGoGBXnCkw3X5fPwKFHsCsg8SS6QZBJMDnp5Cj6Mwe5MaUAKBfwle0yszt9MeH7rEWJV8zCX-P5IQv1PurNkqV3WgM=w873-h721-no"></p>
<p>다음 패키지를 설치해주세요.</p>
<blockquote>
<p>설치 패키지<br>meteor add spectrum:accounts-kakao</p>
</blockquote>
<p>다음은 <code>main.js</code> configuration에 개발자 센터에서 받은 키 값을 등록 합니다. </p>
<p><code>server/main.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">// Set up login services</div><div class="line">Meteor.startup(function() &#123;</div><div class="line"></div><div class="line">  ServiceConfiguration.configurations.remove(&#123;</div><div class="line">    service: &quot;facebook&quot;</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[위 생략]</div><div class="line"></div><div class="line">  // kakao 인증 API 설정</div><div class="line">  ServiceConfiguration.configurations.remove(&#123;</div><div class="line">    service: &quot;kakao&quot;</div><div class="line">  &#125;);</div><div class="line">  ServiceConfiguration.configurations.insert(&#123;</div><div class="line">    service: &quot;kakao&quot;,</div><div class="line">    clientId: &quot;발급받은 REST API 키&quot;,</div><div class="line">    loginStyle: &quot;popup&quot;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line"></div><div class="line">[아래 생략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">  Accounts.config(&#123;</div><div class="line">    loginExpirationInDays: 1,</div></pre></td></tr></table></figure>
<p>로그인 페이지에서 <code>kakao</code>버튼을 클릭하면 로그인이 진행되도록 아래 코드를 입력합니다. </p>
<p><code>clinet/login.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Template.login.events(&#123;</div><div class="line">  &apos;click button[name=btn-singIn]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">[중략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div><div class="line">    return false;</div><div class="line"></div><div class="line">  &#125;,</div><div class="line">  &apos;click button[name=facebook]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">  ...[중략]</div><div class="line">  &#125;,</div><div class="line">  // kakao 로그인 클릭 추가 </div><div class="line">  &apos;click button[name=kakao]&apos; (evt, tmpl)</div><div class="line">  &#123;</div><div class="line">    evt.preventDefault();</div><div class="line">    Meteor.loginWithKakao(function(err)</div><div class="line">    &#123;</div><div class="line">      if(!err)</div><div class="line">      &#123;</div><div class="line">        FlowRouter.go(&apos;/&apos;);</div><div class="line">      &#125;</div><div class="line">      else</div><div class="line">      &#123;</div><div class="line">        console.log(err);</div><div class="line">        Bert.alert( err , &apos;danger&apos;, &apos;growl-top-right&apos; );</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>kakao로부터 받아온 값을 profile에 등록하는 설정을 해줍니다. </p>
<p><code>server/accounts.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">//기타서비스(facebook) 으로 로긴시 profile정보를 따로 입력해줘야 한다.</div><div class="line">Accounts.onCreateUser(function (options, user) &#123;</div><div class="line"></div><div class="line"></div><div class="line">  user.profile = options.profile;// 이렇게 안해주면 profile이 없는 상태로 가입됨...</div><div class="line"></div><div class="line">  // facebook profile 설정</div><div class="line">  if(user.services.facebook)</div><div class="line">  &#123;</div><div class="line">  ...[중략]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // kakap profile 설정</div><div class="line">  if(user.services.kakao)</div><div class="line">  &#123;</div><div class="line">    user.emails = [</div><div class="line">      &#123;</div><div class="line">        address: &apos;none&apos;,</div><div class="line">        verified: true</div><div class="line">      &#125;</div><div class="line">    ];</div><div class="line">    user.profile.serviceType = &apos;kakao&apos;;</div><div class="line">    user.username = user.profile.name;</div><div class="line">    user.profile.gender = &apos;&apos;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  [아래 생략]</div><div class="line">  Meteor.setTimeout(function() &#123; </div><div class="line">  .</div><div class="line">  .</div><div class="line">  .</div></pre></td></tr></table></figure>
<p>이제 kakao로도 로그인 해보세요. 문제가 없다면 정상적으로 로그인 로그인 되는 것을 볼 수 있을 것입니다. kakao의 경우 api로 받을 수 있는 부분이 매우 제한적인 것을 볼 수 있습니다. 이부분은 개발자 페이지에서 따로 사용자가 정의 하여 항목을 늘릴 수 있으니 이부분은 kakao 개발자 페이지를 참고하여 개발하시면 될 것 같습니다. </p>
<hr>
<h3 id="9-기타-사항"><a href="#9-기타-사항" class="headerlink" title="9. 기타 사항"></a>9. 기타 사항</h3><p>사실 Meteor를 이용해 개발을 할 경우 강좌에서와 같이 버튼 하나하나를 만들어 사용하지 않아도 됩니다. 기본적으로 제공하는 account를 이용하면 다음 패키지를 추가 하는 것으로 회원가입 로그인 등의 많은 기능을 바로 사용할 수도 있습니다. 패키지 추가 후 템플릿에 아래와 같이 <code>loginButtons</code> 만 추가하면 됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&#123;&gt; loginButtons&#125;&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>설치 패키지</p>
<ul>
<li>meteor add accounts-ui</li>
</ul>
</blockquote>
<p>이부분에 대한 문서는 아래 링크 페이지에 나와있으니 참고 하시면 되겠습니다. </p>
<p><a href="https://guide.meteor.com/accounts.html" target="_blank" rel="external">https://guide.meteor.com/accounts.html</a></p>
<hr>
<p>이상으로 Meteor custom account 관련 강좌를 마치겠습니다. Meteor 초보 개발자 분들에게 조금이나마 도움이 되었으면 좋겠네요. 개인적으로 느낀 meteor의 가장 큰 매력은 아마도 생산성이 아닐까 생각합니다. 이미 다양한 패키지(강좌에서는 facebook, google 등 다양한 서비스의 인증 연동)를 바로 사용할 수 있고, 백앤드와 프론트앤드를 동시에 개발 할 수 있으며, 심지어 프론트엔드의 빌드머신? 으로 사용하시는 분들도 있는 것으로 알고 있습니다. 하지만 아직 국내에는 meteor를 사용하는 사람이 그리 많지 않아 참 많이 아쉽다는 생각이 듭니다. 여튼 제 부족한 강좌가 조금이나마 meteor에 대한 호기심을 자극한다면 개인적으로 만족할 것 같습니다. 조만간 다른 강좌를 통해서 또 뵙겠습니다. ^^ </p>
<blockquote>
<p>소스코드 링크<br><a href="https://freeseamew.github.io/">https://freeseamew.github.io/</a></p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a class="next" href="/2017/07/04/meteor-account-tutorial-4/">NEXT</a></div><div class="fb-comments" data-href="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-5/" data-width="700" data-numposts="5"></div><div id="disqus_thread"></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>window.fbAsyncInit=function(){FB.init({appId:"1765163213798195",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");</script></body></html>