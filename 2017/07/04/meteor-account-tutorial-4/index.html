<!DOCTYPE html><html prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>Meteor custom account 강좌 4 · freeseamew`s blog</title><meta name="description"><meta name="og:url" content="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-4/"><meta name="og:type" content="article"><meta name="og:title" content="Meteor custom account 강좌 4"><meta name="og:description"><meta name="og:image" content="http://freeseamew.github.io/logo3.png"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><meta name="fb:app_id" content="1765163213798195"><link rel="search" type="application/opensearchdescription+xml" href="http://freeseamew.github.io/atom.xml" title="freeseamew`s blog"></head><body><div id="fb-root"></div><div class="wrap"><header><a class="logo-link" href="/"><img src="/logo3.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">목록보기</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Meteor custom account 강좌 4</h1><div class="post-info"><div class="post-info-profile"><a href="https://github.com/freeseamew" target="_blank"><img src="/image/profile.png"></a></div><div class="post-info-details"><div class="post-categories"></div><div class="post-date">Jul 4, 2017\t</div></div></div><div class="post-share"><div class="fb-like" data-href="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-4/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="false">                 </div><div class="fb-follow" data-href="https://www.facebook.com/freeseamew" data-layout="button_count" data-size="small" data-show-faces="true">   </div><div class="fb-save" data-uri="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-4/" data-size="small"></div></div><div class="post-content"><h3 id="7-화면전환-효과"><a href="#7-화면전환-효과" class="headerlink" title="7. 화면전환 효과"></a>7. 화면전환 효과</h3><p>Meteor 인증(account) 관련 강좌를 더 진행하기 전에 현재만들어진 기능을 조금 보완해 보도록 하겠습니다.<br>router로 원하는 페이지로 이동이 되고 있지만, 좀 더 있어보이게(?) 화면전환 효과를 넣어보겠고, 또 메일발송 때 화면이 정지한것 처럼 몇초간 아무런 액션이 없는 부분에 로딩효과를 넣어보도록 하겠습니다. 사실 이런 부분들은 꼭 있어야 하는 부분은 아니지만, 먼가 앱의 완성도를 높이기위해서는 적용해두는 것이 좋은 것도 사실일 것입니다.<br>강좌 중간에 이런 효과적인 부분을 넣는 이유는 앞으로 남은 부분에도 위의 효과 관련 기능은 계속해서 들어갈 것이기 때문에 여기서 미리 작성하는 것이 소스 코드를 2번 고치지 않게 될 것 같아서 입니다. </p>
<hr>
<h4 id="7-1-애니메이션-효과"><a href="#7-1-애니메이션-효과" class="headerlink" title="7.1 애니메이션 효과"></a>7.1 애니메이션 효과</h4><p>일단 다음 패키지를 설치해주세요. 이 패키지는 Meteor에서 다양한 애니메이션 효과를 낼 수 있도록 해주는 패키지 입니다.</p>
<blockquote>
<p>설치패키지</p>
<ul>
<li>meteor add webtempest:animate</li>
</ul>
</blockquote>
<p>사실 이 패키지에서 사용된 코드는 아래의 애니메이션 프레임워크를 Meteor에서 쉽게 사용할 수 있도록 만든 패키지가 되겠습니다. 아래 링크페이지로 가시면 사용할 수 있는 효과들을 볼 수 있습니다. </p>
<ul>
<li><a href="https://daneden.github.io/animate.css/" target="_blank" rel="noopener">https://daneden.github.io/animate.css/</a></li>
</ul>
<p>사용법은 아래와 같습니다. 효과를 나타내고자 할 요소를 <code>#transition</code> 로 감싸주기만 하면 됩니다.  참 쉽죠? ^^</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;&#123;#transition in=&quot;나타날때효과:효과시간&quot; out=&quot;사라질때효과:효과시간&quot;&#125;&#125;</div><div class="line">  &#123;&#123;&gt; yield&#125;&#125;</div><div class="line">&#123;&#123;/transition&#125;&#125;</div></pre></td></tr></table></figure>
<p>그리고 지금 만들고 있는 account예제의 경우 사실 페이지가 몇개 되지 않지만, 지금보다 훨씬 많은 페이지로 이루어진 서비스의 경우 각 페이지마다 효과를 준다면 약간 귀찮을 것입니다. 그래서 우리의 화면전환 효과는 <code>mainLayout</code> 템플릿만에만 줄 것입니다. 이곳에만 주면, 특별한 상황이 아닌이상, 모든 페이지가 나타날때 효과가 적용되는 것을 볼 수 있을 것입니다. <code>main-layout.html</code> 페이지를 아래와 같이 변경해주세요.</p>
<p><code>client/main-layout.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;template name=&quot;mainLayout&quot;&gt;</div><div class="line">  &lt;div class=&quot;container&quot;&gt;</div><div class="line">    &#123;&#123;#transition in=&quot;fadeIn:500&quot; out=&quot;fadeOut:500&quot;&#125;&#125;</div><div class="line">      &#123;&#123;&gt; Template.dynamic template=content &#125;&#125;</div><div class="line">    &#123;&#123;/transition&#125;&#125;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/template&gt;</div></pre></td></tr></table></figure>
<p>이제 실행을 시켜보면 화면이 부드럽게 전환되는 것을 볼 수 있습니다. </p>
<h4 id="7-2-로딩-효과"><a href="#7-2-로딩-효과" class="headerlink" title="7.2 로딩 효과"></a>7.2 로딩 효과</h4><p>다음은 로딩효과에 대해서 설명드릴 텐데요. 현재 우리가 만들고 있는 페이지에서 로딩 효과가 실제로 필요한 부분은 가입메일 보내기 부분 정도가 될 것입니다. 이중에서도 가입메일 다시보내기 부분의 경우가 2~3초 정도의 딜레이가 생길 수 있어 이때 로딩효과를 주는 것으로 페이지를 좀 더 완성도 있게 보일 수 있을 것으로 생각됩니다. </p>
<p>로딩효과에 사용된 Meteor의 api는 <code>reactive-var</code> 라는 것입니다. 이녀석에 대해서만으로 한챕터 정도 강좌가 필요하겠지만 일단은 간단하게만 설명드리도록 하겠습니다. </p>
<blockquote>
<p><code>reactive-var</code>는 일종의 센서 함수? 라고 보면 될 것 같은데요. 다시말에 어떤 값의 변화를 감지하는 역할을 하는 API라고 보시면 되겠습니다.  <code>reactive-var</code>에 특정 상태를 정의해 두고, 이 상태가 변경될 경우 <code>reactive-var</code>가 작동하게 되는데요. 실제 화재감지 센서에서 열이 감지되면 센서가 스프링 쿨러를 작동시켜 주는 머 그런 기능을 하듯(다른 분께서 이렇게 설명 하신 것을 기억합니다.) <code>reactive-var</code>도 거의 비슷한 역할을 한다고 이해하면 될 것 같습니다. </p>
</blockquote>
<p><code>public/images/</code> 폴더를 만들고, 로딩이미지를 git 페이지에서 다운받아 복사해주세요.</p>
<p>그리고 main-layout.js에 다음과 같이 <code>mainLoading</code> 템플릿을 입력해주세요. 또 mainLayout 템플릿도 아래 소스를 참고로 <code>#if showLoadingEffectLoad</code> 라는 조건문을 하나 추가하겠습니다. </p>
<p><code>client/main-layout.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;template name=&quot;mainLayout&quot;&gt; </div><div class="line">  &#123;&#123;#if showLoadingEffectLoad&#125;&#125; &lt;!-- 추가된 조건문 --&gt;</div><div class="line">    &#123;&#123;#transition in=&quot;fadeIn:500&quot; out=&quot;fadeOut:500&quot;&#125;&#125;</div><div class="line">      &#123;&#123;&gt; mainLoading&#125;&#125;</div><div class="line">    &#123;&#123;/transition&#125;&#125;</div><div class="line">  &#123;&#123;/if&#125;&#125;</div><div class="line">  &lt;div class=&quot;container&quot;&gt;</div><div class="line">    &#123;&#123;#transition in=&quot;fadeIn:500&quot; out=&quot;fadeOut:500&quot;&#125;&#125;</div><div class="line">      &#123;&#123;&gt; Template.dynamic template=content &#125;&#125;</div><div class="line">    &#123;&#123;/transition&#125;&#125;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/template&gt;</div><div class="line"></div><div class="line">&lt;template name=&quot;mainLoading&quot;&gt; &lt;!-- 추가된 템플릿 --&gt;</div><div class="line">  &lt;div class=&quot;table y100 text_center bg-main&quot;&gt;</div><div class="line">    &lt;div class=&quot;table-cell py4&quot;&gt;</div><div class="line">      &lt;img src=&quot;images/loading-spinning-bubbles.svg&quot; width=&quot;64&quot; height=&quot;64&quot; /&gt;</div><div class="line">      &lt;h1 class=&quot;h1 mt2 mb0&quot;&gt;Now loading...&lt;/h1&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/template&gt;</div></pre></td></tr></table></figure>
<p>이제 이 <code>mainLoading</code> 템플릿이 잘 작동하도록 만들어 보도록 하겠습니다.<br>우선은 <code>showLoadingEffect</code> 이라는 값을 정의를 해야 하는데, 이것은 mainLayout 템플릿이 생성될 때 하도록 해주면 되겠습니다. 참고로 이 객체를 <code>window.showLoadingEffect</code>게 만들어 사용하는 이유는 전역으로 해야만 다른 템플릿에서도 이 객체를 사용할 수 있기 때문입니다. 기본값은 false로 정의 하겠습니다.<br>그리고 이 객체를 템플릿 즉 html에서 사용하기 위해서는 helpers에서 불러 줘야 사용이 가능하니 아래 처럼 <code>Template.mainLayout.helpers</code> 에 리턴을 해주면 되겠습니다.<br>이렇게 해두면 최상위 페이지인 main-layout 아래의 모든 페이지는 첫 화면이 뜰 때 기본적으로 <code>showLoadingEffect</code> 가 true가 되고, 따라서 <code>mainLoading</code> 템플릿이 활성화 되는 구조를 가지게 됩니다. </p>
<p><code>client/main-layout.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Template.mainLayout.onCreated(function()&#123;</div><div class="line"></div><div class="line">  // ReactiveVar의 경우 다른 탬플릿에서 사용하기 위해서는 window를 써 전역으로 만들어 줘야만 한다.</div><div class="line">  window.showLoadingEffect = new ReactiveVar(false);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">Template.mainLayout.helpers(&#123;</div><div class="line"></div><div class="line">  showLoadingEffectLoad: function ()</div><div class="line">  &#123;</div><div class="line">    return showLoadingEffect.get();</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>reactive-var 는 일종의 센서? 같은 역할을 한다고 설명드렸습니다. 그럼 이 센서(?)가 어떻게 작동하는지 이제부터 알아보도록 하겠습니다. </p>
<p>이제 모든 클라이언트 페이지에서 ‘showLoadingEffect.set(true);’ 이 set된 값을 true로 하면 <code>&lt;template name=&quot;mainLoading&quot;&gt;&lt;/template&gt;</code>이 보여지고, false로 해주면 이 템플릿이 사라지는 원리입니다.</p>
<p>우선 우리가 만든 페이지 login.html, register.html 페이지에 적용해 페이지가 뜰 때 로딩효과가 나타나도록 해보겠습니다.<br>다음 소스는 현재 사용하고 있는 <code>login.js</code> 페이지에  conCreated와 onRendered 라는 라이프 사이클 함수를 추가한 내용입니다. onCreated 될 때 <code>showLoadingEffect.set(true);</code> 를 작동시키면 기본적으로 로딩 페이지가 보여지게 됩니다. 그리고 onRendered 일때 <code>showLoadingEffect.set(false);</code> 를 해주면 로딩 화면이 사라지게 사라지게 됩니다. 사라질 때는 바로 false를 해버리면 로딩 효과가 너무 빨리 사라지므로 Meteor.setTimeout을 이용해 약간의 딜레이를 주는 것이 좋을 것 같아 아래와 같이 적용했습니다. </p>
<p><code>client/login.js</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Template.login.onCreated(function () &#123;</div><div class="line">  showLoadingEffect.set(true);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">Template.login.onRendered(function () &#123;</div><div class="line"></div><div class="line">  Meteor.setTimeout(function() &#123;</div><div class="line">    showLoadingEffect.set(false);</div><div class="line">  &#125;, 2 * 200);</div><div class="line"></div><div class="line">&#125;);</div><div class="line"></div><div class="line">[아래 생략]</div><div class="line">.</div><div class="line">.</div><div class="line">.</div></pre></td></tr></table></figure>
<p>같은 원리로 로딩 효과를 주고 싶은 다른 페이지에도 conCreated와 onRendered 일 때 위의 소스를 넣어주면 로딩 화면 후에 페이지가 보여지게 됩니다. </p>
<p><img src="https://lh3.googleusercontent.com/K89HeEI5NwNcDQmf0lIV9XViNutCV3Fg6pzdR-LAYA_0YeiKKEFqxB_ay4ULaaynSIptxrHfd4_RY5VsJMuTb-HJc8vRQrL2TA4xCFErqjNQPPcYylzqMwbY3jOdRUFI2XnH5xUhNHFZs12BxgNqXXnL7_2yL3ggbAEpiBd0SPuVKs5V3RRbtx4z_hCkvT7eyL-7GVLQApjjH02GS4nGnhx7qmrqQrVaVhjq579hqa69hDBgkhGjFL0KMbhis8ZK2Ykd-5t6qc7e0f6XFafTnJyxrkcq_sS2V9-qYZ61pB0naeHnEeSquerwY-SClQFSPH-EzU18ZCx_R8G_YxYiXNxzzc2M7al7wVFHwH5DY5-CkgMQrIlIszEUDE3WmNzXrJQgkyjkXBnCB13yHBWAbLmH_r5mzVTvHDKuC2zeNhAtg8g9mwW4mDLoRf61FjhFVaTKYldhkk89AoGoUSd15-64f_d8FLIwu5SjbykeL26YkaCobXHXop5qIuH1fG40IminMSQ4JNEuLXXdywVoT0BBZN5TZXctVc5uZXLbR-jXE3RHN2UFTX2UsVzW6H4GcYzo8xI5CmVznjVzLVl3HJ-gbnDfmVuYt_fJr1g0o5oM3OeisoRDdFc-93_SznFKfNBRDPwZDlwSu_KGfyNJ6mwJnTDaCcweLRcYr-U48z8=w518-h336-no"></p><p style="text-align: center;">[로딩화면]</p><p></p>
<p>다음으로 이 효과를 단순히 화면이 변경될 때 주는 것이 아닌 위에서도 말했지만, 인증메일 재발송 같이 정지 화면으로 2~3초 이상 있어야 하는 페이지에 주는 방법을 설명드리도록 하겠습니다. 사실 적용 방법은 위의 내용과 거의 같습니다. </p>
<p><code>client/home.js</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">Template.home.events(&#123;</div><div class="line">  &apos;click button[name=btn-logout]&apos; (vet, tmpl)</div><div class="line">  &#123;</div><div class="line">    event.preventDefault();</div><div class="line">    Meteor.logout();</div><div class="line">  &#125;,</div><div class="line">  &apos;click button[name=resend-verification-link]&apos; ( event, template ) &#123;</div><div class="line"></div><div class="line">    showLoadingEffect.set(true); // 로딩효과 추가</div><div class="line"></div><div class="line">    let user = Meteor.userId();</div><div class="line"></div><div class="line">    Meteor.call( &apos;sendVerificationLink&apos;, user, ( error, response ) =&gt; &#123;</div><div class="line">      if ( error ) &#123;</div><div class="line">        showLoadingEffect.set(false); // 로딩효과 추가</div><div class="line">        Bert.alert( error.reason, &apos;danger&apos; );</div><div class="line">      &#125;</div><div class="line">      else</div><div class="line">      &#123;</div><div class="line"></div><div class="line"></div><div class="line">        showLoadingEffect.set(false);</div><div class="line">        let email = Meteor.user().emails[ 0 ].address;</div><div class="line">        Bert.alert( `Verification sent to $&#123; email &#125;!`, &apos;success&apos; );</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>메일 재발송 버튼이<code>&#39;click button[name=resend-verification-link]&#39;</code> 클릭되면 <code>showLoadingEffect.set(true);</code> 를 줘서 로딩 화면이 나타나게 해줍니다. 그리고  <code>sendVerificationLink</code> 메소드가 실행되고, 완료되는 타이밍(정상실행이던 오류가 났던)에 <code>showLoadingEffect.set(false);</code> 이 세팅을 해주면 끝입니다. 이제 메일 발송후 몇초간의 타이밍에 이용자가 기다려야 한다는 것을 직관적으로 인지할 수 있는 구조가 되었습니다. </p>
<p><img src="https://lh3.googleusercontent.com/ikmevgfSRK3ENk_Q6Aqjt1By-2ZSi1kkPpfcAr6Zajew3Yqg988lqseg4Rx5kUdyahLCo4OcQrohCmwg5-l6nIya_nxfL9AmLx4th6XqwXWIJOId8CEzcU6OyNB_KgriN_iIyaZQEvWtpMVR1T2qvfQwf3BLpw76N0Qa5VByPnYR-EiFlacsU-9RAd_ISDu-uwIAfHuEaLNBGpIJPPfi0Bpbuwf3yRAFEWT24qHMGad2c81EHC-sRY7HVYm_GpNqFx9pf312tI6tvZIJ51ZAeCZynGtRo7YyQwa4hl5AE6gApVpw7_McpF_i-ZD7BI3m-8GGJ32iqs2U_6QMhLyg-S033WrL_ZP3y1DyPrHgG4OuVu9B2FXJSH_PQNEucVmz42Ro_MdETC9ncVwIEqdwrNvharb0R3ROWVeuiAc1KLoNAnFOOllrIShRzV-D8d7LvwwRkalLO1_CB2ykqgClMeTmJxNRj1O5qWRL7m_uAytfUHYT_5Rzbi-MrsEtvR1eZfSYh_U0_oS4KnLkTgo5YZVtsGJTRwU2ccyOVOcdz7-7GUVLZwXvUvLEYN6rnCp69q4oRYKVrNygY8vaOt6I_9MxtfK57yzClzJC_MgX3H-K9lGeXf7yBqxp3uqmqdnfWZWQsK22dz6iNbRJxgfS2U2I2q6lZcUi2b-ix86uxYw=w806-h528-no"></p>
<p>이상으로 <code>ReactiveVar</code>를 이용한 Meteor로딩에 대해서 알아봤습니다. <code>ReactiveVar</code>는 이를 응용하면 다양한 부분에 활용이 가능한 신기한 Meteor의 기능입니다. 다양한 부분에서 편리하게 이용해 보셔도 좋을 것 같습니다.<br>그럼 다음 시간에 account 강좌를 마무리 해보도록 하겠습니다.  </p>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2017/07/04/meteor-account-tutorial-5/">PREV</a><a class="next" href="/2017/07/04/meteor-account-tutorial-3/">NEXT</a></div><div class="fb-comments" data-href="http://freeseamew.github.io/2017/07/04/meteor-account-tutorial-4/" data-width="700" data-numposts="5"></div><div id="disqus_thread"></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>window.fbAsyncInit=function(){FB.init({appId:"1765163213798195",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView()},function(e,n,t){var o,c=e.getElementsByTagName(n)[0];e.getElementById(t)||((o=e.createElement(n)).id=t,o.src="//connect.facebook.net/en_US/sdk.js",c.parentNode.insertBefore(o,c))}(document,"script","facebook-jssdk");</script></body></html>